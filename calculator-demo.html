<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>복리 계산기 - Apps in Toss</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: #f9fafb;
      margin: 0;
      -webkit-font-smoothing: antialiased;
    }
    .card { background: white; border-radius: 1rem; padding: 1.5rem; box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1); }
    .btn-primary {
      display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
      padding: 0.75rem 1.5rem; background: #3182F6; color: white;
      font-weight: 600; border-radius: 0.75rem; border: none; cursor: pointer;
      transition: background 150ms; width: 100%;
    }
    .btn-primary:hover { background: #1d72f3; }
    .btn-secondary {
      display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
      padding: 0.75rem 1.5rem; background: white; color: #333d4b;
      font-weight: 600; border-radius: 0.75rem; border: 2px solid #e5e8eb; cursor: pointer;
      transition: all 150ms; width: 100%;
    }
    .btn-secondary:hover { background: #f9fafb; }
    .input-field {
      width: 100%; padding: 0.75rem 1rem; font-size: 1rem;
      border: 1px solid #d1d6db; border-radius: 0.5rem;
      outline: none; transition: border-color 150ms;
    }
    .input-field:focus { border-color: #3182F6; }
    .badge {
      display: inline-flex; padding: 0.25rem 0.75rem; border-radius: 9999px;
      font-size: 0.875rem; font-weight: 600;
    }
    .badge-green { background: #dcfce7; color: #15803d; }
    .toast {
      position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%);
      background: #191f28; color: white; padding: 1rem 1.5rem;
      border-radius: 0.75rem; font-size: 0.875rem; font-weight: 500;
      animation: slideUp 200ms ease-out; z-index: 1000;
    }
    @keyframes slideUp { from { transform: translate(-50%, 100%); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // 복리 계산 함수
    function calculateCompoundInterest({ principal, rate, years, monthlyContribution = 0 }) {
      const rateDecimal = rate / 100;
      const yearlyBreakdown = [];
      let totalPrincipal = principal;
      let currentBalance = principal;

      for (let year = 1; year <= years; year++) {
        const yearStartBalance = currentBalance;
        const yearlyContribution = monthlyContribution * 12;
        const balanceGrowth = yearStartBalance * (1 + rateDecimal);

        let contributionGrowth = 0;
        if (monthlyContribution > 0) {
          for (let month = 1; month <= 12; month++) {
            const monthsRemaining = 12 - month + 1;
            contributionGrowth += monthlyContribution * Math.pow(1 + rateDecimal, monthsRemaining / 12);
          }
        }

        currentBalance = balanceGrowth + contributionGrowth;
        totalPrincipal += yearlyContribution;

        yearlyBreakdown.push({
          year,
          principal: Math.round(totalPrincipal),
          interest: Math.round(currentBalance - totalPrincipal),
          balance: Math.round(currentBalance),
        });
      }

      return {
        finalAmount: Math.round(currentBalance),
        totalPrincipal: Math.round(totalPrincipal),
        totalInterest: Math.round(currentBalance - totalPrincipal),
        yearlyBreakdown,
      };
    }

    function formatCurrency(amount) {
      return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' }).format(amount);
    }

    function formatPercent(value) {
      return `${value.toFixed(2)}%`;
    }

    function App() {
      const [input, setInput] = useState({
        principal: 10000000,
        rate: 5,
        years: 10,
        monthlyContribution: 0,
      });
      const [result, setResult] = useState(null);
      const [toast, setToast] = useState(null);

      // Storage 시뮬레이션 (localStorage 사용)
      useEffect(() => {
        const saved = localStorage.getItem('calculator_input');
        if (saved) {
          setInput(JSON.parse(saved));
          showToast('이전 입력값을 불러왔어요');
        }
      }, []);

      useEffect(() => {
        if (input) {
          localStorage.setItem('calculator_input', JSON.stringify(input));
        }
      }, [input]);

      const showToast = (message) => {
        setToast(message);
        setTimeout(() => setToast(null), 3000);
      };

      const handleCalculate = () => {
        const calculated = calculateCompoundInterest(input);
        setResult(calculated);
        showToast('계산이 완료되었어요');
      };

      const handleReset = () => {
        setInput({ principal: 10000000, rate: 5, years: 10, monthlyContribution: 0 });
        setResult(null);
        localStorage.removeItem('calculator_input');
        showToast('초기화되었어요');
      };

      const updateInput = (field, value) => {
        setInput(prev => ({ ...prev, [field]: Number(value) || 0 }));
      };

      return (
        <div style={{ minHeight: '100vh' }}>
          {/* Header */}
          <header style={{ background: 'white', borderBottom: '1px solid #f3f4f6', position: 'sticky', top: 0, zIndex: 10 }}>
            <div style={{ maxWidth: '42rem', margin: '0 auto', padding: '1rem 1.5rem' }}>
              <h1 style={{ fontSize: '1.25rem', fontWeight: 700, margin: 0, color: '#191f28' }}>
                복리 계산기
              </h1>
            </div>
          </header>

          {/* Main */}
          <main style={{ maxWidth: '42rem', margin: '0 auto', padding: '1.5rem' }}>
            {/* 입력 섹션 */}
            <div className="card" style={{ marginBottom: '1rem' }}>
              <h2 style={{ fontSize: '1.125rem', fontWeight: 600, marginBottom: '1rem', color: '#191f28' }}>투자 정보 입력</h2>

              <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                <div>
                  <label style={{ display: 'block', fontSize: '0.875rem', fontWeight: 500, marginBottom: '0.5rem', color: '#4e5968' }}>원금 (원)</label>
                  <input type="number" value={input.principal} onChange={(e) => updateInput('principal', e.target.value)} className="input-field" />
                </div>

                <div>
                  <label style={{ display: 'block', fontSize: '0.875rem', fontWeight: 500, marginBottom: '0.5rem', color: '#4e5968' }}>연 이자율 (%)</label>
                  <input type="number" step="0.1" value={input.rate} onChange={(e) => updateInput('rate', e.target.value)} className="input-field" />
                </div>

                <div>
                  <label style={{ display: 'block', fontSize: '0.875rem', fontWeight: 500, marginBottom: '0.5rem', color: '#4e5968' }}>투자 기간 (년)</label>
                  <input type="number" value={input.years} onChange={(e) => updateInput('years', e.target.value)} className="input-field" />
                </div>

                <div>
                  <label style={{ display: 'block', fontSize: '0.875rem', fontWeight: 500, marginBottom: '0.5rem', color: '#4e5968' }}>월 추가 납입액 (원)</label>
                  <input type="number" value={input.monthlyContribution} onChange={(e) => updateInput('monthlyContribution', e.target.value)} className="input-field" />
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '0.75rem', marginTop: '0.5rem' }}>
                  <button className="btn-primary" onClick={handleCalculate}>계산하기</button>
                  <button className="btn-secondary" onClick={handleReset}>초기화</button>
                </div>
              </div>
            </div>

            {/* 결과 섹션 */}
            {result && (
              <>
                <div className="card" style={{ marginBottom: '1rem' }}>
                  <h2 style={{ fontSize: '1.125rem', fontWeight: 600, marginBottom: '1rem', color: '#191f28' }}>계산 결과</h2>

                  <div style={{ background: '#eff6ff', borderRadius: '0.75rem', padding: '1.5rem', marginBottom: '1rem' }}>
                    <div style={{ fontSize: '0.875rem', color: '#6b7684', marginBottom: '0.5rem' }}>최종 금액</div>
                    <div style={{ fontSize: '2rem', fontWeight: 700, color: '#3182F6' }}>{formatCurrency(result.finalAmount)}</div>
                  </div>

                  <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                    <div style={{ display: 'flex', justifyContent: 'space-between', padding: '0.75rem', background: '#f9fafb', borderRadius: '0.5rem' }}>
                      <span style={{ fontSize: '0.875rem', color: '#6b7684' }}>총 원금</span>
                      <span style={{ fontSize: '0.875rem', fontWeight: 600, color: '#191f28' }}>{formatCurrency(result.totalPrincipal)}</span>
                    </div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', padding: '0.75rem', background: '#f9fafb', borderRadius: '0.5rem' }}>
                      <span style={{ fontSize: '0.875rem', color: '#6b7684' }}>총 이자</span>
                      <span style={{ fontSize: '0.875rem', fontWeight: 600, color: '#15803d' }}>{formatCurrency(result.totalInterest)}</span>
                    </div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', padding: '0.75rem', background: '#f9fafb', borderRadius: '0.5rem' }}>
                      <span style={{ fontSize: '0.875rem', color: '#6b7684' }}>수익률</span>
                      <span className="badge badge-green">{formatPercent((result.totalInterest / result.totalPrincipal) * 100)}</span>
                    </div>
                  </div>
                </div>

                {/* 연도별 상세 */}
                <div className="card">
                  <h2 style={{ fontSize: '1.125rem', fontWeight: 600, marginBottom: '1rem', color: '#191f28' }}>연도별 상세</h2>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                    {result.yearlyBreakdown.map((item) => (
                      <div key={item.year} style={{ display: 'flex', justifyContent: 'space-between', padding: '0.75rem', background: '#f9fafb', borderRadius: '0.5rem' }}>
                        <span style={{ fontSize: '0.875rem', fontWeight: 500, color: '#4e5968' }}>{item.year}년차</span>
                        <div style={{ textAlign: 'right' }}>
                          <div style={{ fontSize: '0.875rem', fontWeight: 600, color: '#191f28' }}>{formatCurrency(item.balance)}</div>
                          <div style={{ fontSize: '0.75rem', color: '#8b95a1' }}>이자: {formatCurrency(item.interest)}</div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </>
            )}
          </main>

          {/* Toast */}
          {toast && <div className="toast">{toast}</div>}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
