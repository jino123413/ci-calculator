name: Build App

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Install dependencies
      run: npm install --legacy-peer-deps

    - name: Build
      run: |
        echo "Starting build..."
        npm run build 2>&1 | tee build.log
        echo "Build exit code: $?"

    - name: Check build output
      run: |
        echo "=== Current directory ==="
        pwd
        echo ""
        echo "=== All files (tree view) ==="
        find . -type f | head -50
        echo ""
        echo "=== Searching for .ait files ==="
        find . -name "*.ait" -type f
        echo ""
        echo "=== Root directory ==="
        ls -lah
        echo ""
        echo "=== Looking for ci-calculator.ait ==="
        if [ -f "ci-calculator.ait" ]; then
          echo "✅ Found ci-calculator.ait"
          ls -lh ci-calculator.ait
          file ci-calculator.ait
        else
          echo "❌ ci-calculator.ait not found in root"
        fi

    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      with:
        name: build
        path: |
          *.ait
          ci-calculator.ait
          dist/
          build.log
      if: always()
